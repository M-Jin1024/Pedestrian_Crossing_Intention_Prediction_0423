 cd /home/minshi/Pedestrian_Crossing_Intention_Prediction ; /usr/bin/env /home/minshi/miniconda3/envs/tf26/bin/python /home/minshi/.vscode/extensions/ms-python.debugpy-2025.14.1-linux-x64/bundled/libs/debugpy/adapter/../../debugpy/launcher 34147 -- /home/minshi/Pedestrian_Crossing_Intention_Prediction/train_and_test_all_epoch_pipeline.py -c config_files/my/my_jaad.yaml 
================================================================================
🎯 训练和测试管道启动
================================================================================
配置文件: config_files/my/my_jaad.yaml
开始时间: 2025-11-12 00:22:54

🚀 开始训练...
2025-11-12 00:22:57.593164: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:57.596551: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:57.596645: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               config_files/my/my_jaad.yaml
model_opts {'model': 'Transformer_depth', 'obs_input_type': ['box', 'depth', 'vehicle_speed', 'ped_speed'], 'enlarge_ratio': 1.5, 'obs_length': 16, 'time_to_event': [30, 60], 'overlap': 0.8, 'balan
ce_data': False, 'apply_class_weights': True, 'dataset': 'jaad', 'normalize_boxes': True, 'generator': True, 'fusion_point': 'early', 'fusion_method': 'sum'}                                        data_opts {'fstride': 1, 'sample_type': 'beh', 'subset': 'default', 'data_split_type': 'default', 'seq_type': 'crossing', 'min_track_size': 76}
net_opts {'num_hidden_units': 256, 'global_pooling': 'avg', 'regularizer_val': 0.0001, 'cell_type': 'gru', 'backbone': 'vgg16', 'dropout': 0.1}
train_opts {'batch_size': 2, 'epochs': 30, 'lr': 5e-05, 'learning_scheduler': {}}
---------------------------------------------------------
Generating action sequence data
fstride: 1
sample_type: beh
subset: default
height_rng: [0, inf]
squarify_ratio: 0
data_split_type: default
seq_type: crossing
min_track_size: 76
random_params: {'ratios': None, 'val_data': True, 'regen_data': False}
kfold_params: {'num_folds': 5, 'fold': 1}
---------------------------------------------------------
Generating database for jaad
jaad database loaded from /home/minshi/Pedestrian_Crossing_Intention_Prediction/JAAD/data_cache/jaad_database.pkl
---------------------------------------------------------
Generating crossing data
Split: train
Number of pedestrians: 324 
Total number of samples: 194 
---------------------------------------------------------
Generating action sequence data
fstride: 1
sample_type: beh
subset: default
height_rng: [0, inf]
squarify_ratio: 0
data_split_type: default
seq_type: crossing
min_track_size: 76
random_params: {'ratios': None, 'val_data': True, 'regen_data': False}
kfold_params: {'num_folds': 5, 'fold': 1}
---------------------------------------------------------
Generating database for jaad
jaad database loaded from /home/minshi/Pedestrian_Crossing_Intention_Prediction/JAAD/data_cache/jaad_database.pkl
---------------------------------------------------------
Generating crossing data
Split: val
Number of pedestrians: 48 
Total number of samples: 22 
---------------------------------------------------------
Generating action sequence data
fstride: 1
sample_type: beh
subset: default
height_rng: [0, inf]
squarify_ratio: 0
data_split_type: default
seq_type: crossing
min_track_size: 76
random_params: {'ratios': None, 'val_data': True, 'regen_data': False}
kfold_params: {'num_folds': 5, 'fold': 1}
---------------------------------------------------------
Generating database for jaad
jaad database loaded from /home/minshi/Pedestrian_Crossing_Intention_Prediction/JAAD/data_cache/jaad_database.pkl
---------------------------------------------------------
Generating crossing data
Split: test
Number of pedestrians: 276 
Total number of samples: 171 
[DataGenerator] auto class_weight -> {0: 0.8247422680412371, 1: 0.17525773195876287}
[DataGenerator] auto class_weight -> {0: 0.7272727272727273, 1: 0.2727272727272727}
2025-11-12 00:22:59.498227: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instru
ctions in performance-critical operations:  AVX2 FMA                                                                                                                                                 To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2025-11-12 00:22:59.499090: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:59.499284: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:59.499346: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:59.781608: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:59.781723: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:59.781811: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:22:59.781873: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 4044 MB memory:  -> device: 0, name: NVIDIA GeF
orce RTX 4060 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 8.9                                                                                                                          
============================================================
📊 MODEL PARAMETER STATISTICS
============================================================
Total parameters:        2,968,717
Trainable parameters:    2,968,711.0
Non-trainable parameters: 6.0
============================================================

/home/minshi/miniconda3/envs/tf26/lib/python3.8/site-packages/keras/optimizer_v2/optimizer_v2.py:355: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  warnings.warn(

🚀 Training started!
📁 Models will be saved to: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s
📋 已复制 action_predict.py 到模型目录
2025-11-12 00:23:00.908756: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
Epoch 1/30
2025-11-12 00:23:04.753429: I tensorflow/stream_executor/cuda/cuda_blas.cc:1760] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
2025-11-12 00:23:05.051539: I tensorflow/stream_executor/cuda/cuda_dnn.cc:369] Loaded cuDNN version 8100
1067/1067 [==============================] - 15s 10ms/step - loss: 9.7686 - cls_loss: 0.2143 - reg_loss: 0.0138 - intention_accuracy: 0.5455 - val_loss: 6.1198 - val_cls_loss: 0.2712 - val_reg_loss
: 0.0042 - val_intention_accuracy: 0.5372                                                                                                                                                            /home/minshi/miniconda3/envs/tf26/lib/python3.8/site-packages/keras/utils/generic_utils.py:494: CustomMaskWarning: Custom mask layers require a config and must override get_config. When loading, th
e custom mask layer must be passed to the custom_objects argument.                                                                                                                                     warnings.warn('Custom mask layers require a config and must override '
[Sigma] Epoch 1: sigma_cls=0.6894 sigma_reg=0.6664
Epoch 2/30
1067/1067 [==============================] - 10s 9ms/step - loss: 4.2135 - cls_loss: 0.1822 - reg_loss: 0.0064 - intention_accuracy: 0.6265 - val_loss: 3.2649 - val_cls_loss: 0.2975 - val_reg_loss:
 0.0092 - val_intention_accuracy: 0.6281                                                                                                                                                             [Sigma] Epoch 2: sigma_cls=0.6811 sigma_reg=0.6405
Epoch 3/30
1067/1067 [==============================] - 10s 9ms/step - loss: 2.3366 - cls_loss: 0.1656 - reg_loss: 0.0047 - intention_accuracy: 0.6415 - val_loss: 2.0231 - val_cls_loss: 0.2535 - val_reg_loss:
 0.0024 - val_intention_accuracy: 0.6074                                                                                                                                                             [Sigma] Epoch 3: sigma_cls=0.6714 sigma_reg=0.6153
Epoch 4/30
1067/1067 [==============================] - 10s 9ms/step - loss: 1.4690 - cls_loss: 0.1613 - reg_loss: 0.0035 - intention_accuracy: 0.6509 - val_loss: 1.3767 - val_cls_loss: 0.2569 - val_reg_loss:
 0.0032 - val_intention_accuracy: 0.5992                                                                                                                                                             [Sigma] Epoch 4: sigma_cls=0.6622 sigma_reg=0.5909
Epoch 5/30
1067/1067 [==============================] - 10s 9ms/step - loss: 0.8865 - cls_loss: 0.1513 - reg_loss: 0.0028 - intention_accuracy: 0.6640 - val_loss: 1.0995 - val_cls_loss: 0.3382 - val_reg_loss:
 0.0021 - val_intention_accuracy: 0.5744                                                                                                                                                             [Sigma] Epoch 5: sigma_cls=0.6525 sigma_reg=0.5672
Epoch 6/30
1067/1067 [==============================] - 10s 9ms/step - loss: 0.4621 - cls_loss: 0.1451 - reg_loss: 0.0026 - intention_accuracy: 0.6968 - val_loss: 0.7130 - val_cls_loss: 0.3186 - val_reg_loss:
 0.0023 - val_intention_accuracy: 0.6405                                                                                                                                                             [Sigma] Epoch 6: sigma_cls=0.6427 sigma_reg=0.5442
Epoch 7/30
1067/1067 [==============================] - 10s 9ms/step - loss: 0.1313 - cls_loss: 0.1362 - reg_loss: 0.0022 - intention_accuracy: 0.7029 - val_loss: 0.4189 - val_cls_loss: 0.3028 - val_reg_loss:
 0.0017 - val_intention_accuracy: 0.5289                                                                                                                                                             [Sigma] Epoch 7: sigma_cls=0.6325 sigma_reg=0.5219
Epoch 8/30
1067/1067 [==============================] - 18s 17ms/step - loss: -0.1221 - cls_loss: 0.1287 - reg_loss: 0.0021 - intention_accuracy: 0.7231 - val_loss: 0.6423 - val_cls_loss: 0.4627 - val_reg_los
s: 0.0015 - val_intention_accuracy: 0.5992                                                                                                                                                           [Sigma] Epoch 8: sigma_cls=0.6223 sigma_reg=0.5004
Epoch 9/30
1067/1067 [==============================] - 23s 21ms/step - loss: -0.3111 - cls_loss: 0.1261 - reg_loss: 0.0019 - intention_accuracy: 0.7184 - val_loss: 0.3449 - val_cls_loss: 0.4013 - val_reg_los
s: 0.0022 - val_intention_accuracy: 0.5992                                                                                                                                                           [Sigma] Epoch 9: sigma_cls=0.6122 sigma_reg=0.4795
Epoch 10/30
1067/1067 [==============================] - 22s 21ms/step - loss: -0.4816 - cls_loss: 0.1172 - reg_loss: 0.0018 - intention_accuracy: 0.7432 - val_loss: 0.2948 - val_cls_loss: 0.4205 - val_reg_los
s: 0.0027 - val_intention_accuracy: 0.5826                                                                                                                                                           [Sigma] Epoch 10: sigma_cls=0.6018 sigma_reg=0.4594
Epoch 11/30
1067/1067 [==============================] - 22s 21ms/step - loss: -0.6291 - cls_loss: 0.1077 - reg_loss: 0.0017 - intention_accuracy: 0.7751 - val_loss: -0.0488 - val_cls_loss: 0.3274 - val_reg_lo
ss: 0.0021 - val_intention_accuracy: 0.5207                                                                                                                                                          [Sigma] Epoch 11: sigma_cls=0.5904 sigma_reg=0.4399
Epoch 12/30
1067/1067 [==============================] - 22s 21ms/step - loss: -0.7682 - cls_loss: 0.0957 - reg_loss: 0.0015 - intention_accuracy: 0.8168 - val_loss: 0.5739 - val_cls_loss: 0.5606 - val_reg_los
s: 0.0017 - val_intention_accuracy: 0.6074                                                                                                                                                           [Sigma] Epoch 12: sigma_cls=0.5778 sigma_reg=0.4211
Epoch 13/30
1067/1067 [==============================] - 11s 11ms/step - loss: -0.8517 - cls_loss: 0.0994 - reg_loss: 0.0016 - intention_accuracy: 0.8163 - val_loss: 0.4114 - val_cls_loss: 0.5204 - val_reg_los
s: 0.0013 - val_intention_accuracy: 0.6818                                                                                                                                                           [Sigma] Epoch 13: sigma_cls=0.5674 sigma_reg=0.4029
Epoch 14/30
1067/1067 [==============================] - 10s 10ms/step - loss: -0.9530 - cls_loss: 0.0942 - reg_loss: 0.0014 - intention_accuracy: 0.8318 - val_loss: 0.3630 - val_cls_loss: 0.5157 - val_reg_los
s: 0.0010 - val_intention_accuracy: 0.6653                                                                                                                                                           [Sigma] Epoch 14: sigma_cls=0.5574 sigma_reg=0.3854
Epoch 15/30
1067/1067 [==============================] - 10s 10ms/step - loss: -1.0724 - cls_loss: 0.0816 - reg_loss: 0.0014 - intention_accuracy: 0.8430 - val_loss: 0.8558 - val_cls_loss: 0.6687 - val_reg_los
s: 0.0010 - val_intention_accuracy: 0.6529                                                                                                                                                           [Sigma] Epoch 15: sigma_cls=0.5461 sigma_reg=0.3686
Epoch 16/30
1067/1067 [==============================] - 10s 10ms/step - loss: -1.1402 - cls_loss: 0.0836 - reg_loss: 0.0013 - intention_accuracy: 0.8519 - val_loss: 0.2656 - val_cls_loss: 0.4977 - val_reg_los
s: 0.0011 - val_intention_accuracy: 0.6488                                                                                                                                                           [Sigma] Epoch 16: sigma_cls=0.5359 sigma_reg=0.3523
Epoch 17/30
1067/1067 [==============================] - 11s 10ms/step - loss: -1.2242 - cls_loss: 0.0795 - reg_loss: 0.0013 - intention_accuracy: 0.8557 - val_loss: 0.2777 - val_cls_loss: 0.5051 - val_reg_los
s: 0.0013 - val_intention_accuracy: 0.6446                                                                                                                                                           [Sigma] Epoch 17: sigma_cls=0.5263 sigma_reg=0.3367
Epoch 18/30
1067/1067 [==============================] - 12s 11ms/step - loss: -1.3068 - cls_loss: 0.0755 - reg_loss: 0.0012 - intention_accuracy: 0.8627 - val_loss: 0.8035 - val_cls_loss: 0.6478 - val_reg_los
s: 8.7363e-04 - val_intention_accuracy: 0.6694                                                                                                                                                       [Sigma] Epoch 18: sigma_cls=0.5165 sigma_reg=0.3216
Epoch 19/30
1067/1067 [==============================] - 19s 18ms/step - loss: -1.3831 - cls_loss: 0.0726 - reg_loss: 0.0013 - intention_accuracy: 0.8810 - val_loss: 0.7384 - val_cls_loss: 0.6274 - val_reg_los
s: 9.6936e-04 - val_intention_accuracy: 0.6322                                                                                                                                                       [Sigma] Epoch 19: sigma_cls=0.5073 sigma_reg=0.3071
Epoch 20/30
1067/1067 [==============================] - 23s 22ms/step - loss: -1.4696 - cls_loss: 0.0668 - reg_loss: 0.0012 - intention_accuracy: 0.8782 - val_loss: 1.3584 - val_cls_loss: 0.7734 - val_reg_los
s: 0.0012 - val_intention_accuracy: 0.6033                                                                                                                                                           [Sigma] Epoch 20: sigma_cls=0.4971 sigma_reg=0.2932
Epoch 21/30
1067/1067 [==============================] - 23s 21ms/step - loss: -1.4949 - cls_loss: 0.0756 - reg_loss: 0.0013 - intention_accuracy: 0.8688 - val_loss: 0.6254 - val_cls_loss: 0.5912 - val_reg_los
s: 8.4217e-04 - val_intention_accuracy: 0.5909                                                                                                                                                       [Sigma] Epoch 21: sigma_cls=0.4895 sigma_reg=0.2799
Epoch 22/30
1067/1067 [==============================] - 23s 21ms/step - loss: -1.6136 - cls_loss: 0.0618 - reg_loss: 0.0013 - intention_accuracy: 0.8936 - val_loss: 1.4155 - val_cls_loss: 0.7693 - val_reg_los
s: 0.0014 - val_intention_accuracy: 0.6322                                                                                                                                                           [Sigma] Epoch 22: sigma_cls=0.4808 sigma_reg=0.2671
Epoch 23/30
1067/1067 [==============================] - 23s 21ms/step - loss: -1.6416 - cls_loss: 0.0696 - reg_loss: 0.0013 - intention_accuracy: 0.8857 - val_loss: 1.0916 - val_cls_loss: 0.6887 - val_reg_los
s: 9.6320e-04 - val_intention_accuracy: 0.6860                                                                                                                                                       [Sigma] Epoch 23: sigma_cls=0.4734 sigma_reg=0.2548
Epoch 24/30
1067/1067 [==============================] - 19s 17ms/step - loss: -1.7300 - cls_loss: 0.0627 - reg_loss: 0.0012 - intention_accuracy: 0.8918 - val_loss: 1.3209 - val_cls_loss: 0.7324 - val_reg_los
s: 7.3033e-04 - val_intention_accuracy: 0.5992                                                                                                                                                       [Sigma] Epoch 24: sigma_cls=0.4659 sigma_reg=0.2430
Epoch 25/30
1067/1067 [==============================] - 12s 11ms/step - loss: -1.7821 - cls_loss: 0.0642 - reg_loss: 0.0013 - intention_accuracy: 0.8814 - val_loss: 1.8996 - val_cls_loss: 0.8466 - val_reg_los
s: 7.9180e-04 - val_intention_accuracy: 0.6446                                                                                                                                                       [Sigma] Epoch 25: sigma_cls=0.4589 sigma_reg=0.2317
Epoch 26/30
1067/1067 [==============================] - 11s 11ms/step - loss: -1.8263 - cls_loss: 0.0666 - reg_loss: 0.0012 - intention_accuracy: 0.8941 - val_loss: 2.5116 - val_cls_loss: 0.9633 - val_reg_los
s: 0.0013 - val_intention_accuracy: 0.5826                                                                                                                                                           [Sigma] Epoch 26: sigma_cls=0.4532 sigma_reg=0.2209
Epoch 27/30
1067/1067 [==============================] - 12s 11ms/step - loss: -1.9143 - cls_loss: 0.0600 - reg_loss: 0.0013 - intention_accuracy: 0.8993 - val_loss: 1.6137 - val_cls_loss: 0.7697 - val_reg_los
s: 0.0021 - val_intention_accuracy: 0.6446                                                                                                                                                           [Sigma] Epoch 27: sigma_cls=0.4473 sigma_reg=0.2105
Epoch 28/30
1067/1067 [==============================] - 12s 12ms/step - loss: -1.9612 - cls_loss: 0.0619 - reg_loss: 0.0012 - intention_accuracy: 0.8899 - val_loss: 1.0742 - val_cls_loss: 0.6593 - val_reg_los
s: 0.0010 - val_intention_accuracy: 0.6736                                                                                                                                                           [Sigma] Epoch 28: sigma_cls=0.4414 sigma_reg=0.2006
Epoch 29/30
1067/1067 [==============================] - 16s 15ms/step - loss: -2.0311 - cls_loss: 0.0593 - reg_loss: 0.0012 - intention_accuracy: 0.8983 - val_loss: 1.7200 - val_cls_loss: 0.7742 - val_reg_los
s: 0.0013 - val_intention_accuracy: 0.6116                                                                                                                                                           [Sigma] Epoch 29: sigma_cls=0.4351 sigma_reg=0.1911
Epoch 30/30
1067/1067 [==============================] - 23s 21ms/step - loss: -2.0929 - cls_loss: 0.0577 - reg_loss: 0.0012 - intention_accuracy: 0.8936 - val_loss: 1.4911 - val_cls_loss: 0.7248 - val_reg_los
s: 0.0011 - val_intention_accuracy: 0.6529                                                                                                                                                           [Sigma] Epoch 30: sigma_cls=0.4297 sigma_reg=0.1820

🎯 Training completed!
📁 All epoch models saved in: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s/epochs
Train model is saved to data/models/jaad/Transformer_depth/12Nov2025-00h22m59s/model.h5
Available metrics: ['loss', 'cls_loss', 'reg_loss', 'intention_accuracy', 'val_loss', 'val_cls_loss', 'val_reg_loss', 'val_intention_accuracy', 'sigma_cls', 'val_sigma_cls', 'sigma_reg', 'val_sigma
_reg']                                                                                                                                                                                               Training plots saved to model directory
Wrote configs to data/models/jaad/Transformer_depth/12Nov2025-00h22m59s/configs.yaml
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 19s 9ms/step

======================================================================
🎯 MODEL TEST RESULTS 🎯
======================================================================
Accuracy:   0.6098
AUC:        0.5583
F1-Score:   0.7099
Precision:  0.6637
Recall:     0.7630
======================================================================

Model saved to data/models/jaad/Transformer_depth/12Nov2025-00h22m59s/

✅ 训练完成 (耗时: 8.4 分钟)
🔍 查找最新模型目录...
📁 找到模型目录: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s

🧪 开始测试模型...
2025-11-12 00:31:21.788919: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:21.795234: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:21.795425: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               🚀 开始测试模型目录: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s
✅ 配置文件加载成功
✅ 数据集初始化成功
🔄 生成测试数据...
---------------------------------------------------------
Generating action sequence data
fstride: 1
sample_type: beh
subset: default
height_rng: [0, inf]
squarify_ratio: 0
data_split_type: default
seq_type: crossing
min_track_size: 76
random_params: {'ratios': None, 'val_data': True, 'regen_data': False}
kfold_params: {'num_folds': 5, 'fold': 1}
---------------------------------------------------------
Generating database for jaad
jaad database loaded from /home/minshi/Pedestrian_Crossing_Intention_Prediction/JAAD/data_cache/jaad_database.pkl
---------------------------------------------------------
Generating crossing data
Split: test
Number of pedestrians: 276 
Total number of samples: 171 
✅ 测试数据生成完成
📁 找到 31 个模型文件

============================================================
进度: 1/31

🔍 测试模型: epoch_001_loss_6.1198_acc_0.5372.h5
2025-11-12 00:31:23.305546: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instru
ctions in performance-critical operations:  AVX2 FMA                                                                                                                                                 To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2025-11-12 00:31:23.308143: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:23.308363: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:23.308493: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:23.831019: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:23.831235: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:23.831406: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so re
turning NUMA node zero                                                                                                                                                                               2025-11-12 00:31:23.831529: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 4103 MB memory:  -> device: 0, name: NVIDIA GeF
orce RTX 4060 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 8.9                                                                                                                          [DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
2025-11-12 00:31:25.660637: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
2025-11-12 00:31:27.549990: I tensorflow/stream_executor/cuda/cuda_blas.cc:1760] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
2025-11-12 00:31:28.154058: I tensorflow/stream_executor/cuda/cuda_dnn.cc:369] Loaded cuDNN version 8100
1881/1881 [==============================] - 20s 9ms/step
✅ 准确率: 0.6316, AUC: 0.7155, F1: 0.6692

============================================================
进度: 2/31

🔍 测试模型: epoch_002_loss_3.2649_acc_0.6281.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 18s 9ms/step
✅ 准确率: 0.6635, AUC: 0.7329, F1: 0.7168

============================================================
进度: 3/31

🔍 测试模型: epoch_003_loss_2.0231_acc_0.6074.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 19s 10ms/step
✅ 准确率: 0.6555, AUC: 0.7215, F1: 0.6920

============================================================
进度: 4/31

🔍 测试模型: epoch_004_loss_1.3767_acc_0.5992.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 15s 7ms/step
✅ 准确率: 0.6284, AUC: 0.7048, F1: 0.6457

============================================================
进度: 5/31

🔍 测试模型: epoch_005_loss_1.0995_acc_0.5744.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 10s 5ms/step
✅ 准确率: 0.6550, AUC: 0.7131, F1: 0.7135

============================================================
进度: 6/31

🔍 测试模型: epoch_006_loss_0.7130_acc_0.6405.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 10s 5ms/step
✅ 准确率: 0.6486, AUC: 0.6922, F1: 0.7061

============================================================
进度: 7/31

🔍 测试模型: epoch_007_loss_0.4189_acc_0.5289.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 4ms/step
✅ 准确率: 0.6465, AUC: 0.7157, F1: 0.6633

============================================================
进度: 8/31

🔍 测试模型: epoch_008_loss_0.6423_acc_0.5992.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 8s 4ms/step
✅ 准确率: 0.6736, AUC: 0.7169, F1: 0.7186

============================================================
进度: 9/31

🔍 测试模型: epoch_009_loss_0.3449_acc_0.5992.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 4ms/step
✅ 准确率: 0.6449, AUC: 0.6990, F1: 0.6988

============================================================
进度: 10/31

🔍 测试模型: epoch_010_loss_0.2948_acc_0.5826.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 4ms/step
✅ 准确率: 0.6497, AUC: 0.6999, F1: 0.6916

============================================================
进度: 11/31

🔍 测试模型: epoch_011_loss_-0.0488_acc_0.5207.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 5ms/step
✅ 准确率: 0.6119, AUC: 0.6591, F1: 0.6460

============================================================
进度: 12/31

🔍 测试模型: epoch_012_loss_0.5739_acc_0.6074.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 10s 5ms/step
✅ 准确率: 0.5960, AUC: 0.6383, F1: 0.6823

============================================================
进度: 13/31

🔍 测试模型: epoch_013_loss_0.4114_acc_0.6818.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 13s 7ms/step
✅ 准确率: 0.6348, AUC: 0.6821, F1: 0.7286

============================================================
进度: 14/31

🔍 测试模型: epoch_014_loss_0.3630_acc_0.6653.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 18s 9ms/step
✅ 准确率: 0.5976, AUC: 0.6431, F1: 0.6988

============================================================
进度: 15/31

🔍 测试模型: epoch_015_loss_0.8558_acc_0.6529.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 18s 9ms/step
✅ 准确率: 0.6342, AUC: 0.6809, F1: 0.7304

============================================================
进度: 16/31

🔍 测试模型: epoch_016_loss_0.2656_acc_0.6488.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 18s 9ms/step
✅ 准确率: 0.5827, AUC: 0.6291, F1: 0.7063

============================================================
进度: 17/31

🔍 测试模型: epoch_017_loss_0.2777_acc_0.6446.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 17s 9ms/step
✅ 准确率: 0.5800, AUC: 0.6173, F1: 0.6926

============================================================
进度: 18/31

🔍 测试模型: epoch_018_loss_0.8035_acc_0.6694.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 10s 5ms/step
✅ 准确率: 0.6061, AUC: 0.6650, F1: 0.7188

============================================================
进度: 19/31

🔍 测试模型: epoch_019_loss_0.7384_acc_0.6322.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 4ms/step
✅ 准确率: 0.6039, AUC: 0.6568, F1: 0.7144

============================================================
进度: 20/31

🔍 测试模型: epoch_020_loss_1.3584_acc_0.6033.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 8s 4ms/step
✅ 准确率: 0.6342, AUC: 0.6938, F1: 0.7107

============================================================
进度: 21/31

🔍 测试模型: epoch_021_loss_0.6254_acc_0.5909.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 4ms/step
✅ 准确率: 0.6332, AUC: 0.6594, F1: 0.7151

============================================================
进度: 22/31

🔍 测试模型: epoch_022_loss_1.4155_acc_0.6322.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 4ms/step
✅ 准确率: 0.6326, AUC: 0.6772, F1: 0.7300

============================================================
进度: 23/31

🔍 测试模型: epoch_023_loss_1.0916_acc_0.6860.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 5ms/step
✅ 准确率: 0.6077, AUC: 0.6365, F1: 0.7200

============================================================
进度: 24/31

🔍 测试模型: epoch_024_loss_1.3209_acc_0.5992.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 12s 6ms/step
✅ 准确率: 0.5933, AUC: 0.6450, F1: 0.6881

============================================================
进度: 25/31

🔍 测试模型: epoch_025_loss_1.8996_acc_0.6446.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 19s 9ms/step
✅ 准确率: 0.5991, AUC: 0.6546, F1: 0.7148

============================================================
进度: 26/31

🔍 测试模型: epoch_026_loss_2.5116_acc_0.5826.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 19s 9ms/step
✅ 准确率: 0.6252, AUC: 0.6338, F1: 0.7145

============================================================
进度: 27/31

🔍 测试模型: epoch_027_loss_1.6137_acc_0.6446.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 19s 9ms/step
✅ 准确率: 0.6188, AUC: 0.6363, F1: 0.6955

============================================================
进度: 28/31

🔍 测试模型: epoch_028_loss_1.0742_acc_0.6736.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 19s 9ms/step
✅ 准确率: 0.6411, AUC: 0.6706, F1: 0.7341

============================================================
进度: 29/31

🔍 测试模型: epoch_029_loss_1.7200_acc_0.6116.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 10s 5ms/step
✅ 准确率: 0.6130, AUC: 0.6380, F1: 0.7147

============================================================
进度: 30/31

🔍 测试模型: epoch_030_loss_1.4911_acc_0.6529.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 10s 5ms/step
✅ 准确率: 0.6098, AUC: 0.6542, F1: 0.7099

============================================================
进度: 31/31

🔍 测试模型: model.h5
[DataGenerator] auto class_weight -> {0: 0.6257309941520468, 1: 0.3742690058479532}
1881/1881 [==============================] - 9s 4ms/step
✅ 准确率: 0.6098, AUC: 0.6542, F1: 0.7099

📊 结果已保存到: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s/test_results_20251112_003843.csv
📝 报告已保存到: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s/test_report_20251112_003843.txt

🏆 准确率最高的模型: epoch_008_loss_0.6423_acc_0.5992.h5 (准确率: 0.6736)
🗑️  开始清理epochs目录，将删除 30 个模型文件...
🗑️  已删除: epoch_026_loss_2.5116_acc_0.5826.h5
🗑️  已删除: epoch_015_loss_0.8558_acc_0.6529.h5
🗑️  已删除: epoch_019_loss_0.7384_acc_0.6322.h5
🗑️  已删除: epoch_029_loss_1.7200_acc_0.6116.h5
🗑️  已删除: epoch_020_loss_1.3584_acc_0.6033.h5
🗑️  已删除: epoch_018_loss_0.8035_acc_0.6694.h5
🗑️  已删除: epoch_003_loss_2.0231_acc_0.6074.h5
🗑️  已删除: epoch_027_loss_1.6137_acc_0.6446.h5
🗑️  已删除: epoch_016_loss_0.2656_acc_0.6488.h5
🗑️  已删除: epoch_006_loss_0.7130_acc_0.6405.h5
🗑️  已删除: epoch_002_loss_3.2649_acc_0.6281.h5
🗑️  已删除: epoch_013_loss_0.4114_acc_0.6818.h5
🗑️  已删除: epoch_010_loss_0.2948_acc_0.5826.h5
🗑️  已删除: epoch_021_loss_0.6254_acc_0.5909.h5
🗑️  已删除: epoch_023_loss_1.0916_acc_0.6860.h5
🗑️  已删除: epoch_024_loss_1.3209_acc_0.5992.h5
🗑️  已删除: epoch_028_loss_1.0742_acc_0.6736.h5
🗑️  已删除: epoch_017_loss_0.2777_acc_0.6446.h5
🗑️  已删除: epoch_014_loss_0.3630_acc_0.6653.h5
🗑️  已删除: epoch_011_loss_-0.0488_acc_0.5207.h5
📋 已将最佳模型复制到: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s/epoch_008_loss_0.6423_acc_0.5992.h5
🗑️  已删除: epoch_008_loss_0.6423_acc_0.5992.h5
🗑️  已删除: epoch_012_loss_0.5739_acc_0.6074.h5
🗑️  已删除: epoch_009_loss_0.3449_acc_0.5992.h5
🗑️  已删除: epoch_005_loss_1.0995_acc_0.5744.h5
🗑️  已删除: epoch_030_loss_1.4911_acc_0.6529.h5
🗑️  已删除: epoch_022_loss_1.4155_acc_0.6322.h5
🗑️  已删除: epoch_025_loss_1.8996_acc_0.6446.h5
🗑️  已删除: epoch_007_loss_0.4189_acc_0.5289.h5
🗑️  已删除: epoch_004_loss_1.3767_acc_0.5992.h5
🗑️  已删除: epoch_001_loss_6.1198_acc_0.5372.h5
🗑️  已删除空的epochs目录
🔄 模型目录已重命名:
   原目录: 12Nov2025-00h22m59s
   新目录: 12Nov2025-00h22m59s_acc_0.6736

================================================================================
🎯 测试结果汇总
================================================================================
总模型数量: 31
成功测试: 31
失败测试: 0

📊 性能统计:
平均准确率: 0.6246 (±0.0241)
平均AUC: 0.6722 (±0.0324)
平均F1: 0.7029 (±0.0227)

🏆 最佳模型:
最高准确率: epoch_008_loss_0.6423_acc_0.5992.h5 (Acc: 0.6736)
最高AUC: epoch_002_loss_3.2649_acc_0.6281.h5 (AUC: 0.7329)
最高F1: epoch_028_loss_1.0742_acc_0.6736.h5 (F1: 0.7341)

✅ 测试完成 (耗时: 7.5 分钟)

================================================================================
🎉 训练和测试管道完成!
================================================================================
模型目录: data/models/jaad/Transformer_depth/12Nov2025-00h22m59s
总耗时: 15.8 分钟
结束时间: 2025-11-12 00:38:45
================================================================================
